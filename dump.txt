PROJECT DUMP (2026-01-15T15:41:25)
ROOT: D:/dfmea_v6_frontendmockup/dfmea_v6_frontendmockup
EXCLUDES: ProcessForceGraph.js, RequirementsViewport.js


==========================================================================================
FILE: app/page.js
==========================================================================================
// app/page.js
"use client";

import { useMemo, useState } from "react";
import TopNav from "../components/TopNav";
import Sidebar from "../components/Sidebar";
import Workspace from "../components/Workspace";

import requirementsJson from "../data/requirements.json";
import processDiagram from "../data/processDiagram.json";
import rootCauseAnalysis from "../data/rootCauseAnalysis.json";
import workflowsJson from "../data/workflows.json";

import { DFMEAProvider } from "../contexts/Context";

export default function Page() {
  // ‚úÖ Removed "Workflows" from TopNav tabs (no sheet exposure)
  const tabs = useMemo(
    () => [
      { id: "requirements", label: "Requirements" },
      { id: "processDiagram", label: "Process Diagram" },
      { id: "rootCauseAnalysis", label: "Root Cause Analysis" }
    ],
    []
  );

  const [requirementsData, setRequirementsData] = useState(requirementsJson);

  // ‚úÖ Make workflows stateful so Sidebar can create/select workflows
  const [workflowsData, setWorkflowsData] = useState(workflowsJson);

  // ‚úÖ Which workflow is selected (from sidebar)
  const [selectedWorkflowId, setSelectedWorkflowId] = useState(
    workflowsJson?.content?.workflows?.[0]?.id ?? ""
  );

  const tabDataMap = useMemo(
    () => ({
      requirements: requirementsData,
      processDiagram,
      rootCauseAnalysis,
      workflows: workflowsData
    }),
    [requirementsData, workflowsData]
  );

  const [activeTab, setActiveTab] = useState("requirements");

  // ‚úÖ DEV: override gating anytime
  const [devOverride, setDevOverride] = useState(false);

  // ‚úÖ QUICK DEV: once you click List view once, tabs become accessible
  const [listViewUnlocked, setListViewUnlocked] = useState(false);

  const requirementsUnlocked = useMemo(() => {
    const reqs = requirementsData?.content?.requirements ?? [];
    if (!reqs.length) return false;
    const allComplete = reqs.every((r) => !!r.isComplete);
    const noneFlagged = reqs.every((r) => !r.flagged);
    return allComplete && noneFlagged;
  }, [requirementsData]);

  const canAccessOtherTabs = requirementsUnlocked || devOverride || listViewUnlocked;

  function handleChangeTab(nextTabId) {
    // ‚úÖ Workflows accessible always
    if (nextTabId === "workflows") {
      setActiveTab("workflows");
      return;
    }

    if (nextTabId !== "requirements" && !canAccessOtherTabs) return;
    setActiveTab(nextTabId);
  }

  function onDevJumpTo(tabId) {
    setActiveTab(tabId);
  }

  function onUpdateRequirements(nextRequirementsArray) {
    setRequirementsData((prev) => ({
      ...prev,
      content: {
        ...prev.content,
        requirements: nextRequirementsArray
      }
    }));
  }

  // ‚úÖ Add new workflow from sidebar (local mock create)
  function onCreateWorkflow() {
    const newId = `wf-my-${Math.random().toString(16).slice(2, 7)}`;

    const newWorkflow = {
      id: newId,
      category: "design",
      owner: "me",
      title: "My Workflow ‚Ä¢ New SOP",
      summary: "A personal workflow template you can build step-by-step.",
      textSteps: ["Start", "Add steps to define your SOP", "End"],
      diagram: {
        grid: 20,
        zoom: 1,
        nodes: [
          {
            id: "m0",
            type: "start",
            x: 80,
            y: 80,
            w: 200,
            h: 70,
            title: "Start",
            detail: "Kick off workflow"
          },
          {
            id: "m1",
            type: "end",
            x: 420,
            y: 80,
            w: 220,
            h: 80,
            title: "End",
            detail: "Close workflow"
          }
        ],
        edges: [{ id: "me0", from: "m0", to: "m1", label: "finish" }]
      }
    };

    setWorkflowsData((prev) => ({
      ...prev,
      content: {
        ...prev.content,
        workflows: [...(prev?.content?.workflows ?? []), newWorkflow]
      }
    }));

    setSelectedWorkflowId(newId);
    setActiveTab("workflows");
  }

  return (
    <DFMEAProvider>
      <div className="h-screen bg-[#fbfbfa] text-zinc-900 antialiased">
        {/* desktop-only gate */}
        <div className="lg:hidden h-screen flex items-center justify-center p-8">
          <div className="max-w-md text-center">
            <div className="text-xl font-semibold tracking-tight">Desktop required</div>
            <div className="mt-2 text-sm text-zinc-600">
              This mock UI is designed strictly for desktop layouts.
            </div>
          </div>
        </div>

        <div className="hidden lg:flex h-full flex-col overflow-hidden">
          <TopNav tabs={tabs} activeTab={activeTab} onChangeTab={handleChangeTab} />

          <div className="flex flex-1 overflow-hidden">
            <Sidebar
              tasksTitle={tabDataMap[activeTab].tasksTitle}
              tasks={tabDataMap[activeTab].tasks}
              activeTab={activeTab}
              onChangeTab={handleChangeTab}
              workflows={workflowsData?.content?.workflows ?? []}
              selectedWorkflowId={selectedWorkflowId}
              onSelectWorkflowId={setSelectedWorkflowId}
              onCreateWorkflow={onCreateWorkflow}
            />

            <Workspace
              tabData={tabDataMap[activeTab]}
              onUpdateRequirements={onUpdateRequirements}
              requirementsUnlocked={requirementsUnlocked}
              devOverride={devOverride}
              onDevSetOverride={setDevOverride}
              onDevJumpTo={onDevJumpTo}
              onListViewUnlock={() => setListViewUnlocked(true)}
              selectedWorkflowId={selectedWorkflowId}
              onSelectWorkflowId={setSelectedWorkflowId}
            />
          </div>
        </div>
      </div>
    </DFMEAProvider>
  );
}


==========================================================================================
FILE: components/AiDock.js
==========================================================================================
// components/AiDock.js
"use client";

import { useEffect, useRef, useState } from "react";
import {
  ChevronDown,
  Maximize2,
  Expand,
  Plus,
  ArrowUp,
  Loader2
} from "lucide-react";

const cx = (...c) => c.filter(Boolean).join(" ");

/* ----------------------------- Shadows (different recipes) ----------------------------- */
const SH_DOCK =
  "shadow-[0_1px_0_rgba(0,0,0,0.06),0_30px_70px_rgba(0,0,0,0.16)]";

export default function AiDock({ tabData }) {
  const [input, setInput] = useState("");
  const [messages, setMessages] = useState([]);
  const [dockOpen, setDockOpen] = useState(false);
  const [dockSize, setDockSize] = useState("sm"); // sm | md | lg
  const [fullscreen, setFullscreen] = useState(false);
  const listRef = useRef(null);

  useEffect(() => {
    setInput("");
    setMessages([{ role: "assistant", text: tabData.assistant.welcome }]);
  }, [tabData.tabId, tabData.assistant.welcome]);

  useEffect(() => {
    const el = listRef.current;
    if (!el) return;
    el.scrollTop = el.scrollHeight;
  }, [messages, dockOpen, dockSize, fullscreen]);

  function send(text) {
    const trimmed = text.trim();
    if (!trimmed) return;

    setMessages((m) => [
      ...m,
      { role: "user", text: trimmed },
      {
        role: "assistant",
        text:
          "Mock response. Wire this to your LLM later (and pass selected DFMEA context / viewport data)."
      }
    ]);

    setInput("");
    setDockOpen(true); // when you send, show the conversation
  }

  function cycleSize() {
    setDockSize((s) => (s === "sm" ? "md" : s === "md" ? "lg" : "sm"));
    setDockOpen(true);
  }

  const heightClass =
    dockSize === "sm" ? "h-44" : dockSize === "lg" ? "h-[520px]" : "h-64";

  const Shell = ({ children, className = "" }) => (
    <div
      className={cx(
        "rounded-2xl border border-zinc-200/80 bg-white overflow-hidden",
        SH_DOCK,
        className
      )}
    >
      {children}
    </div>
  );

  const PromptChips = () =>
    tabData.assistant?.suggestedPrompts?.length ? (
      <div className="px-4 pb-3 bg-white">
        <div className="flex flex-wrap gap-2">
          {tabData.assistant.suggestedPrompts.map((p) => (
            <button
              key={p}
              onClick={() => send(p)}
              className="text-[11px] px-2.5 py-1 rounded-full bg-zinc-100 hover:bg-zinc-200/70 border border-zinc-200/80 text-zinc-700 transition-colors"
            >
              {p}
            </button>
          ))}
        </div>
      </div>
    ) : null;

  const Messages = () => (
    <div
      ref={listRef}
      className={cx("overflow-y-auto px-4 py-4 space-y-3 bg-[#fbfbfa]", heightClass)}
    >
      {messages.map((m, idx) => (
        <div
          key={idx}
          className={cx(
            "max-w-[85%] rounded-2xl px-3 py-2 text-[13px] leading-relaxed tracking-tight",
            m.role === "user"
              ? "ml-auto bg-zinc-900 text-white"
              : "bg-white border border-zinc-200/80 text-zinc-800"
          )}
        >
          {m.text}
        </div>
      ))}
    </div>
  );

  // ChatGPT-like composer: centered, small, always usable
  const CompactComposer = ({ compact }) => (
    <div className={cx("bg-white", compact ? "p-3" : "p-3 border-t border-zinc-200/70")}>
      <div className="flex items-center gap-2 rounded-2xl border border-zinc-200/80 bg-white px-3 py-2">
        <button
          type="button"
          className="h-8 w-8 rounded-full grid place-items-center hover:bg-zinc-100 transition-colors"
          aria-label="Attach"
        >
          <Plus size={16} strokeWidth={1.8} className="text-zinc-700" />
        </button>

        <input
          value={input}
          onChange={(e) => setInput(e.target.value)}
          onKeyDown={(e) => e.key === "Enter" && send(input)}
          className="flex-1 text-[13px] tracking-tight outline-none placeholder:text-zinc-400"
          placeholder="Ask anything‚Ä¶"
        />

        <button
          type="button"
          onClick={() => send(input)}
          className={cx(
            "h-8 w-8 rounded-full grid place-items-center",
            input.trim()
              ? "bg-zinc-900 hover:bg-zinc-800"
              : "bg-zinc-200 cursor-not-allowed",
            "transition-colors"
          )}
          aria-label="Send"
          disabled={!input.trim()}
        >
          <ArrowUp size={16} strokeWidth={2.2} className="text-white" />
        </button>
      </div>

      {compact ? (
        <div className="mt-2 flex items-center justify-between">
          <button
            onClick={() => setDockOpen(true)}
            className="text-[11px] text-zinc-600 hover:text-zinc-900 transition-colors"
          >
            Open chat
          </button>
          <div className="text-[11px] text-zinc-500">
            AI Assistant ‚Ä¢ {tabData.title}
          </div>
        </div>
      ) : (
        <div className="mt-2 text-[11px] text-zinc-500">
          Tip: later you can add ‚ÄúSend selection to AI‚Äù from the viewport.
        </div>
      )}
    </div>
  );

  const Fullscreen = () => {
    if (!fullscreen) return null;

    return (
      <div className="fixed inset-0 z-50">
        <div
          className="absolute inset-0 bg-zinc-950/20 backdrop-blur-sm"
          onClick={() => setFullscreen(false)}
        />
        <div className="absolute inset-0 p-6 flex">
          <div className="m-auto w-full max-w-4xl h-[80vh]">
            <Shell>
              <div className="px-4 py-3 flex items-center justify-between bg-white border-b border-zinc-200/70">
                <div>
                  <div className="text-[13px] font-semibold tracking-tight text-zinc-900">
                    AI Assistant
                  </div>
                  <div className="text-[11px] text-zinc-500">Full window ‚Ä¢ mock</div>
                </div>
                <button
                  onClick={() => setFullscreen(false)}
                  className="text-[11px] px-2 py-1 rounded-xl bg-zinc-100 hover:bg-zinc-200/70 border border-zinc-200/80 text-zinc-700 transition-colors"
                >
                  Close
                </button>
              </div>

              <PromptChips />
              <div className="h-[calc(80vh-170px)]">
                <div
                  ref={listRef}
                  className="h-full overflow-y-auto px-4 py-4 space-y-3 bg-[#fbfbfa]"
                >
                  {messages.map((m, idx) => (
                    <div
                      key={idx}
                      className={cx(
                        "max-w-[85%] rounded-2xl px-3 py-2 text-[13px] leading-relaxed tracking-tight",
                        m.role === "user"
                          ? "ml-auto bg-zinc-900 text-white"
                          : "bg-white border border-zinc-200/80 text-zinc-800"
                      )}
                    >
                      {m.text}
                    </div>
                  ))}
                </div>
              </div>
              <CompactComposer compact={false} />
            </Shell>
          </div>
        </div>
      </div>
    );
  };

  return (
    <>
      <Fullscreen />

      {/* CENTERED dock width (ChatGPT-ish) */}
      <div className="max-w-[860px] mx-auto">
        {/* Collapsed state = compact composer only, still typeable */}
        {!dockOpen ? (
          <Shell className="rounded-[26px]">
            <div className="px-4 py-2 flex items-center justify-between bg-white">
              <button
                onClick={() => setDockOpen(true)}
                className="inline-flex items-center gap-1 text-[11px] px-2 py-1 rounded-xl bg-zinc-100 hover:bg-zinc-200/70 border border-zinc-200/80 text-zinc-700 transition-colors"
                title="Expand"
              >
                <ChevronDown size={14} strokeWidth={1.7} className="rotate-180" />
                Expand
              </button>

              <div className="text-[11px] text-zinc-500">AI Assistant</div>

              <button
                onClick={() => setFullscreen(true)}
                className="inline-flex items-center gap-1 text-[11px] px-2 py-1 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 transition-colors"
                title="Full window"
              >
                <Maximize2 size={14} strokeWidth={1.7} />
                Full
              </button>
            </div>

            <CompactComposer compact />
          </Shell>
        ) : (
          <Shell>
            <div className="px-4 py-3 flex items-center justify-between bg-white border-b border-zinc-200/70">
              <div className="min-w-0">
                <div className="text-[13px] font-semibold tracking-tight text-zinc-900">
                  AI Assistant
                </div>
                <div className="text-[11px] text-zinc-500 truncate">
                  Context-aware chat (mock) ‚Ä¢ {tabData.title}
                </div>
              </div>

              <div className="flex items-center gap-1.5">
                <button
                  onClick={() => setDockOpen(false)}
                  className="inline-flex items-center gap-1 text-[11px] px-2 py-1 rounded-xl bg-zinc-100 hover:bg-zinc-200/70 border border-zinc-200/80 text-zinc-700 transition-colors"
                  title="Collapse"
                >
                  <ChevronDown size={14} strokeWidth={1.7} />
                  Collapse
                </button>

                <button
                  onClick={cycleSize}
                  className="inline-flex items-center gap-1 text-[11px] px-2 py-1 rounded-xl bg-zinc-100 hover:bg-zinc-200/70 border border-zinc-200/80 text-zinc-700 transition-colors"
                  title="Resize"
                >
                  <Expand size={14} strokeWidth={1.7} />
                  Size
                </button>

                <button
                  onClick={() => setFullscreen(true)}
                  className="inline-flex items-center gap-1 text-[11px] px-2 py-1 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 transition-colors"
                  title="Full window"
                >
                  <Maximize2 size={14} strokeWidth={1.7} />
                  Full
                </button>
              </div>
            </div>

            <PromptChips />
            <Messages />
            <CompactComposer compact={false} />
          </Shell>
        )}
      </div>
    </>
  );
}


==========================================================================================
FILE: components/ProcessDiagramViewport.js
==========================================================================================
// components/ProcessDiagramViewport.js
"use client";

import ProcessForceGraph from "./ProcessForceGraph";

export default function ProcessDiagramViewport() {
  return (
    <div
      className={[
        "relative",
        // Full canvas height inside the workspace scroll area:
        // top nav is 56px, workspace header is 48px => 104px
        // this makes the graph feel full-screen.
        "h-[calc(100vh-104px)]",
        "bg-[#fbfbfa]"
      ].join(" ")}
    >
      {/* Optional tiny label (very subtle, no big title spacing) */}
      <div className="absolute left-10 top-6 z-10">
        <div className="text-[13px] font-medium tracking-tight text-zinc-900">
          Process Diagram
        </div>
        <div className="mt-1 text-[11px] text-zinc-500 tracking-tight">
          requirements ‚Üí systems ‚Üí functions
        </div>
      </div>

      {/* Graph fills entire viewport */}
      <div className="absolute inset-0">
        <ProcessForceGraph />
      </div>
    </div>
  );
}


==========================================================================================
FILE: components/RootCauseViewport.js
==========================================================================================
// components/RootCauseViewport.js
"use client";

const cx = (...c) => c.filter(Boolean).join(" ");

/* ----------------------------- Shadows (different recipes) ----------------------------- */
const SH_SURFACE =
  "shadow-[0_1px_0_rgba(0,0,0,0.05),0_14px_40px_rgba(0,0,0,0.06)]";
const SH_TILE =
  "shadow-[0_1px_0_rgba(0,0,0,0.05),0_10px_24px_rgba(0,0,0,0.06)]";

function PageTitle({ title, subtitle }) {
  return (
    <div className="max-w-5xl mx-auto px-10 pt-14 pb-6">
      <div className="text-[40px] leading-[1.12] font-semibold tracking-tight">
        {title}
      </div>
      {subtitle ? (
        <div className="mt-2 text-[13px] text-zinc-600 tracking-tight">{subtitle}</div>
      ) : null}
    </div>
  );
}

function Surface({ className = "", children, shadow = SH_SURFACE }) {
  return (
    <div
      className={cx(
        "rounded-xl border border-zinc-200/80 bg-white",
        shadow,
        className
      )}
    >
      {children}
    </div>
  );
}

export default function RootCauseViewport({ data }) {
  const { focusItem, categories, fiveWhys } = data.content;

  return (
    <div className="pb-24">
      <PageTitle title="Root Cause Analysis" />

      <div className="max-w-6xl mx-auto px-10">
        <Surface className="p-6">
          <div className="text-[13px] font-medium tracking-tight text-zinc-900">
            Focus item
          </div>

          <div className="mt-4 grid grid-cols-12 gap-4 text-[13px] tracking-tight">
            <div className="col-span-6">
              <div className="text-[11px] text-zinc-500">Failure mode</div>
              <div className="mt-1 text-zinc-900">{focusItem.failureMode}</div>
            </div>
            <div className="col-span-6">
              <div className="text-[11px] text-zinc-500">Effect</div>
              <div className="mt-1 text-zinc-900">{focusItem.effect}</div>
            </div>

            <div className="col-span-12">
              <div className="text-[11px] text-zinc-500">Current controls</div>
              <div className="mt-2 flex flex-wrap gap-2">
                {focusItem.currentControls.map((c, idx) => (
                  <span
                    key={idx}
                    className="text-[11px] px-2 py-1 rounded-full border border-zinc-200/80 bg-[#fbfbfa] text-zinc-700"
                  >
                    {c}
                  </span>
                ))}
              </div>
            </div>
          </div>
        </Surface>

        <div className="mt-6 grid grid-cols-12 gap-6">
          <div className="col-span-7">
            <div className="text-[13px] font-medium tracking-tight">
              Fishbone categories
            </div>
            <div className="mt-3 space-y-3">
              {categories.map((cat) => (
                <Surface key={cat.name} shadow={SH_TILE} className="overflow-hidden">
                  <div className="px-5 py-4 flex items-center justify-between border-b border-zinc-200/70 bg-[#fbfbfa]">
                    <div className="text-[13px] font-medium tracking-tight">
                      {cat.name}
                    </div>
                    <div className="text-[11px] text-zinc-500">
                      {cat.items.length} items
                    </div>
                  </div>
                  <div className="px-5 py-4 space-y-2">
                    {cat.items.map((it, idx) => (
                      <div key={idx} className="text-[13px] text-zinc-800 flex gap-2">
                        <span className="text-zinc-300">‚Ä¢</span>
                        <span>{it}</span>
                      </div>
                    ))}
                  </div>
                </Surface>
              ))}
            </div>
          </div>

          <div className="col-span-5">
            <div className="text-[13px] font-medium tracking-tight">5 Whys</div>
            <Surface className="mt-3 overflow-hidden" shadow={SH_TILE}>
              {fiveWhys.map((w, idx) => (
                <div
                  key={idx}
                  className={cx(
                    "px-5 py-4",
                    idx !== 0 && "border-t border-zinc-200/70"
                  )}
                >
                  <div className="text-[11px] text-zinc-500">Why {w.why}</div>
                  <div className="mt-1 text-[13px] text-zinc-800">{w.text}</div>
                </div>
              ))}
            </Surface>
          </div>
        </div>
      </div>
    </div>
  );
}


==========================================================================================
FILE: components/Sidebar copy.js
==========================================================================================
"use client";

import { useState } from "react";
import {
  Home,
  CalendarDays,
  Sparkles,
  Inbox,
  Settings,
  Trash2,
  Search
} from "lucide-react";

const cx = (...c) => c.filter(Boolean).join(" ");

function NavItem({ icon: Icon, label, active }) {
  return (
    <div
      className={cx(
        "px-2 py-1.5 rounded-md cursor-default flex items-center gap-2",
        "text-[13px] tracking-tight",
        "hover:bg-zinc-200/40 transition-colors",
        active ? "bg-zinc-200/50 text-zinc-900" : "text-zinc-700"
      )}
    >
      <Icon size={16} strokeWidth={1.7} className="text-zinc-700" />
      <span className="truncate font-medium">{label}</span>
    </div>
  );
}

function ModernCheckbox({ defaultChecked }) {
  const [checked, setChecked] = useState(!!defaultChecked);

  const tick =
    "data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20viewBox%3D%270%200%2024%2024%27%20fill%3D%27none%27%20stroke%3D%27white%27%20stroke-width%3D%272.8%27%20stroke-linecap%3D%27round%27%20stroke-linejoin%3D%27round%27%3E%3Cpolyline%20points%3D%2720%206%209%2017%204%2012%27/%3E%3C/svg%3E";

  return (
    <input
      type="checkbox"
      checked={checked}
      onChange={(e) => setChecked(e.target.checked)}
      className={cx(
        "h-4 w-4 rounded-[6px] appearance-none",
        "bg-white border border-zinc-300/80",
        "focus:outline-none focus:ring-2 focus:ring-zinc-300",
        "transition bg-no-repeat bg-center"
      )}
      style={{
        backgroundSize: "14px 14px",
        backgroundImage: checked ? `url("${tick}")` : "none",
        backgroundColor: checked ? "#18181b" : "#ffffff"
      }}
      aria-checked={checked}
    />
  );
}

export default function Sidebar({ tasksTitle, tasks = [] }) {
  return (
    <aside className="w-[280px] h-full bg-[#f5f5f3] border-r border-zinc-200/70">
      <div className="h-full flex flex-col px-3 py-3">
        {/* header */}
        <div className="flex items-center gap-3 px-2 py-2 rounded-md hover:bg-zinc-200/40 transition-colors">
          <div className="h-8 w-8 rounded-xl bg-white border border-zinc-200/80 flex items-center justify-center text-xs font-semibold text-zinc-800">
            IA
          </div>
          <div className="min-w-0 leading-tight">
            <div className="text-[13px] font-semibold tracking-tight text-zinc-900 truncate">
              Engineering Space
            </div>
            <div className="text-[11px] text-zinc-500 truncate">Workspace ‚Ä¢ mock</div>
          </div>
        </div>

        {/* search (Notion-ish) */}
        <div className="mt-2 px-2">
          <div className="rounded-md bg-white border border-zinc-200/80 px-2.5 py-2 flex items-center gap-2">
            <Search size={16} strokeWidth={1.7} className="text-zinc-600" />
            <input
              className="w-full text-[13px] tracking-tight outline-none placeholder:text-zinc-400 bg-transparent"
              placeholder="Search"
              disabled
            />
          </div>
        </div>

        {/* nav */}
        <div className="mt-3 px-2 space-y-0.5">
          <NavItem icon={Home} label="Home" />
          <NavItem icon={CalendarDays} label="Meetings" />
          <NavItem icon={Sparkles} label="Notion AI" />
          <NavItem icon={Inbox} label="Inbox" />
        </div>

        {/* tasks */}
        <div className="mt-5 px-2">
          <div className="text-[11px] font-medium text-zinc-500 tracking-tight">
            {tasksTitle || "Tasks"}
          </div>

          <div className="mt-2 space-y-1">
            {tasks.map((t) => (
              <div
                key={t.id}
                className={cx(
                  "px-2 py-1.5 rounded-md",
                  "hover:bg-zinc-200/40 transition-colors",
                  "flex items-center gap-2"
                )}
              >
                <ModernCheckbox defaultChecked={t.done} />
                <div
                  className={cx(
                    "text-[13px] tracking-tight",
                    t.done ? "text-zinc-400 line-through" : "text-zinc-800"
                  )}
                >
                  {t.label}
                </div>
              </div>
            ))}

            {!tasks.length ? (
              <div className="text-[12px] text-zinc-500 px-2 py-2">
                No tasks in this tab.
              </div>
            ) : null}
          </div>
        </div>

        {/* footer */}
        <div className="mt-auto px-2 pt-4 space-y-0.5">
          <NavItem icon={Settings} label="Settings" />
          <NavItem icon={Trash2} label="Trash" />
        </div>
      </div>
    </aside>
  );
}


==========================================================================================
FILE: components/Sidebar.js
==========================================================================================
// components/Sidebar.js
"use client";

import { useMemo, useState } from "react";
import {
  Home,
  CalendarDays,
  Sparkles,
  Inbox,
  Settings,
  Trash2,
  Search,
  ChevronDown,
  GitBranch,
  Plus
} from "lucide-react";

const cx = (...c) => c.filter(Boolean).join(" ");

function NavItem({ icon: Icon, label, active, onClick, right }) {
  return (
    <button
      type="button"
      onClick={onClick}
      className={cx(
        "w-full px-2 py-1.5 rounded-md cursor-default flex items-center gap-2",
        "text-[13px] tracking-tight text-left",
        "hover:bg-zinc-200/40 transition-colors",
        active ? "bg-zinc-200/50 text-zinc-900" : "text-zinc-700"
      )}
    >
      <Icon size={16} strokeWidth={1.7} className="text-zinc-700" />
      <span className="truncate font-medium flex-1">{label}</span>
      {right}
    </button>
  );
}

function ModernCheckbox({ defaultChecked }) {
  const [checked, setChecked] = useState(!!defaultChecked);

  const tick =
    "data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20viewBox%3D%270%200%2024%2024%27%20fill%3D%27none%27%20stroke%3D%27white%27%20stroke-width%3D%272.8%27%20stroke-linecap%3D%27round%27%20stroke-linejoin%3D%27round%27%3E%3Cpolyline%20points%3D%2720%206%209%2017%204%2012%27/%3E%3C/svg%3E";

  return (
    <input
      type="checkbox"
      checked={checked}
      onChange={(e) => setChecked(e.target.checked)}
      className={cx(
        "h-4 w-4 rounded-[6px] appearance-none",
        "bg-white border border-zinc-300/80",
        "focus:outline-none focus:ring-2 focus:ring-zinc-300",
        "transition bg-no-repeat bg-center"
      )}
      style={{
        backgroundSize: "14px 14px",
        backgroundImage: checked ? `url("${tick}")` : "none",
        backgroundColor: checked ? "#18181b" : "#ffffff"
      }}
      aria-checked={checked}
    />
  );
}

function SubItem({ label, onClick, active, icon: Icon }) {
  return (
    <button
      type="button"
      onClick={onClick}
      className={cx(
        "w-full px-2 py-1.5 rounded-md text-left",
        "text-[12px] tracking-tight",
        "hover:bg-zinc-200/40 transition-colors",
        "flex items-center gap-2",
        active ? "text-zinc-900 bg-zinc-200/40" : "text-zinc-700"
      )}
    >
      {Icon ? <Icon size={14} strokeWidth={1.8} className="text-zinc-600" /> : null}
      <span className="truncate">{label}</span>
    </button>
  );
}

export default function Sidebar({
  tasksTitle,
  tasks = [],
  activeTab,
  onChangeTab,
  workflows = [],
  selectedWorkflowId,
  onSelectWorkflowId,
  onCreateWorkflow
}) {
  const [workflowsOpen, setWorkflowsOpen] = useState(true);

  const rightChevron = useMemo(
    () => (
      <ChevronDown
        size={16}
        strokeWidth={1.8}
        className={cx(
          "text-zinc-500 transition-transform",
          workflowsOpen ? "rotate-0" : "-rotate-90"
        )}
      />
    ),
    [workflowsOpen]
  );

  const firstDesign = workflows.find((w) => w.category === "design")?.id;
  const firstValidation = workflows.find((w) => w.category === "validation")?.id;
  const firstMine = workflows.find((w) => w.owner === "me")?.id;

  return (
    <aside className="w-[280px] h-full bg-[#f5f5f3] border-r border-zinc-200/70">
      <div className="h-full flex flex-col px-3 py-3">
        {/* header */}
        <div className="flex items-center gap-3 px-2 py-2 rounded-md hover:bg-zinc-200/40 transition-colors">
          <div className="h-8 w-8 rounded-xl bg-white border border-zinc-200/80 flex items-center justify-center text-xs font-semibold text-zinc-800">
            IA
          </div>
          <div className="min-w-0 leading-tight">
            <div className="text-[13px] font-semibold tracking-tight text-zinc-900 truncate">
              Engineering Space
            </div>
            <div className="text-[11px] text-zinc-500 truncate">Workspace ‚Ä¢ mock</div>
          </div>
        </div>

        {/* search */}
        <div className="mt-2 px-2">
          <div className="rounded-md bg-white border border-zinc-200/80 px-2.5 py-2 flex items-center gap-2">
            <Search size={16} strokeWidth={1.7} className="text-zinc-600" />
            <input
              className="w-full text-[13px] tracking-tight outline-none placeholder:text-zinc-400 bg-transparent"
              placeholder="Search"
              disabled
            />
          </div>
        </div>

        {/* nav */}
        <div className="mt-3 px-2 space-y-0.5">
          <NavItem icon={Home} label="Home" />
          <NavItem icon={CalendarDays} label="Meetings" />
          <NavItem icon={Sparkles} label="Notion AI" />
          <NavItem icon={Inbox} label="Inbox" />

          {/* Workflows */}
          <NavItem
            icon={GitBranch}
            label="Workflows"
            active={activeTab === "workflows"}
            right={rightChevron}
            onClick={() => {
              setWorkflowsOpen((v) => !v);
              onChangeTab?.("workflows");
            }}
          />

          {workflowsOpen ? (
            <div className="pl-6 mt-0.5 space-y-0.5">
              <SubItem
                label="Design Workflows"
                active={selectedWorkflowId === firstDesign}
                onClick={() => {
                  onChangeTab?.("workflows");
                  if (firstDesign) onSelectWorkflowId?.(firstDesign);
                }}
              />
              <SubItem
                label="Validation Workflows"
                active={selectedWorkflowId === firstValidation}
                onClick={() => {
                  onChangeTab?.("workflows");
                  if (firstValidation) onSelectWorkflowId?.(firstValidation);
                }}
              />
              <SubItem
                label="My Workflows"
                active={selectedWorkflowId === firstMine}
                onClick={() => {
                  onChangeTab?.("workflows");
                  if (firstMine) onSelectWorkflowId?.(firstMine);
                }}
              />

              {/* NEW: Add workflow */}
              <SubItem
                label="Add new workflow"
                icon={Plus}
                onClick={() => {
                  onChangeTab?.("workflows");
                  onCreateWorkflow?.();
                }}
              />
            </div>
          ) : null}
        </div>

        {/* tasks */}
        <div className="mt-5 px-2">
          <div className="text-[11px] font-medium text-zinc-500 tracking-tight">
            {tasksTitle || "Tasks"}
          </div>

          <div className="mt-2 space-y-1">
            {tasks.map((t) => (
              <div
                key={t.id}
                className={cx(
                  "px-2 py-1.5 rounded-md",
                  "hover:bg-zinc-200/40 transition-colors",
                  "flex items-center gap-2"
                )}
              >
                <ModernCheckbox defaultChecked={t.done} />
                <div
                  className={cx(
                    "text-[13px] tracking-tight",
                    t.done ? "text-zinc-400 line-through" : "text-zinc-800"
                  )}
                >
                  {t.label}
                </div>
              </div>
            ))}

            {!tasks.length ? (
              <div className="text-[12px] text-zinc-500 px-2 py-2">
                No tasks in this tab.
              </div>
            ) : null}
          </div>
        </div>

        {/* footer */}
        <div className="mt-auto px-2 pt-4 space-y-0.5">
          <NavItem icon={Settings} label="Settings" />
          <NavItem icon={Trash2} label="Trash" />
        </div>
      </div>
    </aside>
  );
}


==========================================================================================
FILE: components/TopNav.js
==========================================================================================
// components/TopNav.js
"use client";

import { useLayoutEffect, useMemo, useRef, useState } from "react";
import { Search, Bell, CheckCircle2, Loader2, X } from "lucide-react";
import { useDFMEA } from "../contexts/Context";

const cx = (...c) => c.filter(Boolean).join(" ");

function Pill({ tone = "neutral", children }) {
  const cls =
    tone === "good"
      ? "bg-emerald-50 border-emerald-200/70 text-emerald-900"
      : tone === "busy"
      ? "bg-[#fbfbfa] border-zinc-200/80 text-zinc-700"
      : "bg-[#fbfbfa] border-zinc-200/80 text-zinc-700";

  return (
    <span className={cx("text-[11px] px-2 py-1 rounded-full border tracking-tight", cls)}>
      {children}
    </span>
  );
}

export default function TopNav({ tabs, activeTab, onChangeTab }) {
  const containerRef = useRef(null);
  const tabRefs = useRef({});
  const [indicator, setIndicator] = useState({ x: 0, w: 0, ready: false });

  const {
    activeNotice,
    noticeHistory,
    noticeAnalyzing,
    unreadCount,
    markAllRead,
    dismissActiveNotice
  } = useDFMEA();

  const [toastOpen, setToastOpen] = useState(false);

  const activeLabel = useMemo(
    () => tabs.find((t) => t.id === activeTab)?.label ?? "",
    [tabs, activeTab]
  );

  const measure = () => {
    const wrap = containerRef.current;
    const el = tabRefs.current[activeTab];
    if (!wrap || !el) return;

    const x = el.offsetLeft;
    const w = el.offsetWidth;

    setIndicator((prev) => {
      if (prev.ready && prev.x === x && prev.w === w) return prev;
      return { x, w, ready: true };
    });
  };

  useLayoutEffect(() => {
    measure();

    const wrap = containerRef.current;
    if (!wrap) return;

    const ro = new ResizeObserver(() => measure());
    ro.observe(wrap);

    const activeEl = tabRefs.current[activeTab];
    if (activeEl) ro.observe(activeEl);

    return () => ro.disconnect();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [activeTab, tabs.length]);

  const activeBusy = activeNotice ? !!noticeAnalyzing?.[activeNotice.noticeId] : false;

  return (
    <div className="h-14 px-5 flex items-center justify-between bg-[#fbfbfa] border-b border-zinc-200/70">
      {/* Left: brand + tabs */}
      <div className="grid grid-cols-[280px_1fr] items-center gap-4 min-w-0">
        <div className="flex items-center gap-3 w-[280px] min-w-[280px]">
          <div className="h-8 w-8 rounded-xl bg-zinc-900 text-white flex items-center justify-center text-xs font-semibold">
            DF
          </div>

          <div className="min-w-0 leading-tight">
            <div className="text-[13px] font-semibold tracking-tight text-zinc-900 truncate">
              DFMEA Studio
            </div>
            <div className="text-[11px] text-zinc-500 truncate">
              Desktop mock ‚Ä¢ <span className="text-zinc-700">{activeLabel}</span>
            </div>
          </div>
        </div>

        <div className="flex items-center min-w-0">
          <div
            ref={containerRef}
            className={cx(
              "relative hidden lg:flex items-center gap-1",
              "bg-white rounded-xl p-1",
              "border border-zinc-200/80"
            )}
          >
            {/* sliding indicator */}
            <div
              aria-hidden="true"
              className={cx(
                "pointer-events-none absolute top-1 bottom-1 rounded-lg bg-zinc-900",
                "transition-[transform,width,opacity] duration-300 ease-out will-change-transform"
              )}
              style={{
                width: indicator.w,
                transform: `translate3d(${indicator.x}px,0,0)`,
                opacity: indicator.ready ? 1 : 0
              }}
            />

            {tabs.map((t) => {
              const isActive = t.id === activeTab;
              return (
                <button
                  key={t.id}
                  ref={(node) => {
                    if (node) tabRefs.current[t.id] = node;
                  }}
                  onClick={() => onChangeTab(t.id)}
                  className={cx(
                    "relative z-10 text-[13px] px-3 py-1.5 rounded-lg",
                    "font-medium tracking-tight transition-colors duration-200",
                    isActive ? "text-white" : "text-zinc-700 hover:text-zinc-900"
                  )}
                >
                  {t.label}
                </button>
              );
            })}
          </div>
        </div>
      </div>

      {/* Right */}
      <div className="flex items-center gap-3 relative">
        <div className="hidden xl:flex items-center gap-2 bg-white rounded-xl px-3 py-2 border border-zinc-200/80">
          <Search size={18} strokeWidth={1.6} className="text-zinc-600" />
          <input
            className="w-64 text-[13px] outline-none placeholder:text-zinc-400 bg-transparent"
            placeholder="Search (mock)"
            disabled
          />
        </div>

        {/* üîî Change notice (active card + toast history) */}
        <div className="relative">
          <button
            onClick={() => {
              setToastOpen((v) => !v);
              markAllRead();
            }}
            className={cx(
              "h-10 w-10 rounded-xl bg-white border border-zinc-200/80",
              "grid place-items-center hover:bg-zinc-100 transition-colors"
            )}
            title="Change notices"
            aria-label="Change notices"
          >
            <Bell size={18} strokeWidth={1.6} className="text-zinc-700" />

            {unreadCount ? (
              <span className="absolute -top-1 -right-1 h-5 min-w-[20px] px-1 rounded-full bg-zinc-900 text-white text-[10px] grid place-items-center">
                {unreadCount}
              </span>
            ) : null}
          </button>

          {/* ‚úÖ Active notice card (ONLY ONE, with X close)
              Appears even when dropdown closed. */}
          {activeNotice && !toastOpen ? (
            <div
              className={cx(
                "absolute right-0 mt-2 w-[380px] z-50",
                "rounded-2xl border border-zinc-200/80 bg-white overflow-hidden",
                "shadow-[0_1px_0_rgba(0,0,0,0.05),0_20px_50px_rgba(0,0,0,0.12)]"
              )}
            >
              <div className="px-4 py-3 flex items-start gap-3">
                <div className="mt-0.5 h-8 w-8 rounded-xl bg-white border border-zinc-200/80 grid place-items-center">
                  <Bell size={16} strokeWidth={1.8} className="text-zinc-700" />
                </div>

                <div className="min-w-0 flex-1">
                  <div className="flex items-start justify-between gap-3">
                    <div className="min-w-0">
                      <div className="text-[13px] font-semibold tracking-tight text-zinc-900">
                        Change notice ‚Ä¢ {activeNotice.reqId}
                      </div>
                      <div className="mt-0.5 text-[11px] text-zinc-500 tracking-tight line-clamp-2">
                        {activeNotice.summary}
                      </div>
                    </div>

                    <button
                      onClick={dismissActiveNotice}
                      className="h-8 w-8 rounded-xl grid place-items-center hover:bg-zinc-100 transition-colors"
                      aria-label="Close"
                      title="Close"
                    >
                      <X size={16} strokeWidth={1.8} className="text-zinc-600" />
                    </button>
                  </div>

                  <div className="mt-2 flex items-center gap-2">
                    <Pill>{activeNotice.requestedBy}</Pill>
                    <Pill>{activeNotice.timestamp}</Pill>

                    {activeBusy ? (
                      <Pill tone="busy">
                        <span className="inline-flex items-center gap-1.5">
                          <Loader2 size={12} strokeWidth={2} className="animate-spin" />
                          AI analyzing‚Ä¶
                        </span>
                      </Pill>
                    ) : (
                      <Pill tone="good">
                        <span className="inline-flex items-center gap-1.5">
                          <CheckCircle2 size={12} strokeWidth={2} />
                          Done
                        </span>
                      </Pill>
                    )}
                  </div>

                  <div className="mt-3 rounded-xl border border-zinc-200/80 bg-[#fbfbfa] p-3">
                    <div className="text-[11px] text-zinc-500">Impact</div>
                    <div className="mt-1 text-[13px] text-zinc-800">
                      {activeNotice.impact}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          ) : null}

          {/* Dropdown history */}
          {toastOpen ? (
            <div
              className={cx(
                "absolute right-0 mt-2 w-[360px] z-50",
                "rounded-2xl border border-zinc-200/80 bg-white overflow-hidden",
                "shadow-[0_1px_0_rgba(0,0,0,0.05),0_20px_50px_rgba(0,0,0,0.12)]"
              )}
            >
              <div className="px-4 py-3 border-b border-zinc-200/70 bg-[#fbfbfa] flex items-center justify-between">
                <div>
                  <div className="text-[13px] font-semibold tracking-tight text-zinc-900">
                    Change notices
                  </div>
                  <div className="text-[11px] text-zinc-500 tracking-tight">
                    Auto risk analysis runs in background (mock)
                  </div>
                </div>

                <button
                  onClick={() => setToastOpen(false)}
                  className="text-[11px] px-2 py-1 rounded-xl bg-white border border-zinc-200/80 text-zinc-700 hover:bg-zinc-100 transition-colors"
                >
                  Close
                </button>
              </div>

              <div className="max-h-[360px] overflow-y-auto">
                {!noticeHistory.length ? (
                  <div className="px-4 py-4 text-[12px] text-zinc-500">No notices yet.</div>
                ) : (
                  noticeHistory.map((n) => {
                    const busy = !!noticeAnalyzing[n.noticeId];
                    return (
                      <div
                        key={n.noticeId}
                        className="px-4 py-3 border-b last:border-b-0 border-zinc-200/60 hover:bg-[#fbfbfa] transition-colors"
                      >
                        <div className="text-[13px] font-semibold tracking-tight text-zinc-900">
                          {n.reqId} ‚Ä¢ change notice
                        </div>
                        <div className="mt-0.5 text-[11px] text-zinc-500 tracking-tight line-clamp-2">
                          {n.summary}
                        </div>

                        <div className="mt-2 flex items-center gap-2">
                          <Pill>{n.requestedBy}</Pill>
                          <Pill>{n.timestamp}</Pill>
                          {busy ? (
                            <Pill tone="busy">
                              <span className="inline-flex items-center gap-1.5">
                                <Loader2 size={12} strokeWidth={2} className="animate-spin" />
                                AI analyzing‚Ä¶
                              </span>
                            </Pill>
                          ) : (
                            <Pill tone="good">
                              <span className="inline-flex items-center gap-1.5">
                                <CheckCircle2 size={12} strokeWidth={2} />
                                Done
                              </span>
                            </Pill>
                          )}
                        </div>
                      </div>
                    );
                  })
                )}
              </div>
            </div>
          ) : null}
        </div>

        <button className="text-[13px] font-medium tracking-tight px-3.5 py-2 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 transition-colors">
          Share
        </button>
      </div>
    </div>
  );
}


==========================================================================================
FILE: components/Workflows.js
==========================================================================================
// components/Workflows.js
"use client";

import { useEffect, useMemo, useRef, useState } from "react";
import { Plus, List, Workflow as WorkflowIcon, Save, ZoomIn, ZoomOut } from "lucide-react";

const cx = (...c) => c.filter(Boolean).join(" ");

function snapToGrid(value, grid) {
  return Math.round(value / grid) * grid;
}

function nodeRect(n) {
  return {
    left: n.x,
    right: n.x + n.w,
    top: n.y,
    bottom: n.y + n.h,
    cx: n.x + n.w / 2,
    cy: n.y + n.h / 2
  };
}

function choosePortSide(from, to) {
  const a = nodeRect(from);
  const b = nodeRect(to);

  const dx = b.cx - a.cx;
  const dy = b.cy - a.cy;

  if (Math.abs(dx) >= Math.abs(dy)) return dx >= 0 ? "right" : "left";
  return dy >= 0 ? "bottom" : "top";
}

function portPoint(node, side) {
  const r = nodeRect(node);
  if (side === "left") return { x: r.left, y: r.cy };
  if (side === "right") return { x: r.right, y: r.cy };
  if (side === "top") return { x: r.cx, y: r.top };
  return { x: r.cx, y: r.bottom };
}

function oppositeSide(side) {
  if (side === "left") return "right";
  if (side === "right") return "left";
  if (side === "top") return "bottom";
  return "top";
}

function edgeBezier(fromPt, toPt, fromSide, toSide) {
  const dx = toPt.x - fromPt.x;
  const dy = toPt.y - fromPt.y;

  const strength = Math.max(90, Math.min(280, Math.sqrt(dx * dx + dy * dy) * 0.35));

  const c1 =
    fromSide === "left"
      ? { x: fromPt.x - strength, y: fromPt.y }
      : fromSide === "right"
      ? { x: fromPt.x + strength, y: fromPt.y }
      : fromSide === "top"
      ? { x: fromPt.x, y: fromPt.y - strength }
      : { x: fromPt.x, y: fromPt.y + strength };

  const c2 =
    toSide === "left"
      ? { x: toPt.x - strength, y: toPt.y }
      : toSide === "right"
      ? { x: toPt.x + strength, y: toPt.y }
      : toSide === "top"
      ? { x: toPt.x, y: toPt.y - strength }
      : { x: toPt.x, y: toPt.y + strength };

  const d = `M ${fromPt.x} ${fromPt.y} C ${c1.x} ${c1.y} ${c2.x} ${c2.y} ${toPt.x} ${toPt.y}`;
  return { d, c1, c2 };
}

function cubicAt(P0, P1, P2, P3, t) {
  const mt = 1 - t;
  const mt2 = mt * mt;
  const t2 = t * t;

  const x =
    P0.x * mt2 * mt +
    3 * P1.x * mt2 * t +
    3 * P2.x * mt * t2 +
    P3.x * t2 * t;

  const y =
    P0.y * mt2 * mt +
    3 * P1.y * mt2 * t +
    3 * P2.y * mt * t2 +
    P3.y * t2 * t;

  return { x, y };
}

export default function Workflows({
  data,
  selectedWorkflowId,
  onSelectWorkflowId
}) {
  const workflows = data?.content?.workflows ?? [];

  // ‚úÖ Controlled selection (from sidebar)
  const fallbackId = workflows?.[0]?.id ?? "";
  const effectiveSelectedId = selectedWorkflowId || fallbackId;

  const activeWorkflow = useMemo(
    () => workflows.find((w) => w.id === effectiveSelectedId) ?? workflows?.[0],
    [workflows, effectiveSelectedId]
  );

  const grid = activeWorkflow?.diagram?.grid ?? 20;

  const [viewMode, setViewMode] = useState("diagram"); // diagram | text
  const [nodes, setNodes] = useState(activeWorkflow?.diagram?.nodes ?? []);
  const [edges, setEdges] = useState(activeWorkflow?.diagram?.edges ?? []);
  const [zoom, setZoom] = useState(activeWorkflow?.diagram?.zoom ?? 1);

  const [selectedNodeId, setSelectedNodeId] = useState(null);
  const [drag, setDrag] = useState(null);

  const [saving, setSaving] = useState(false);
  const [savedToast, setSavedToast] = useState(false);

  const initialRef = useRef({
    nodes: JSON.stringify(activeWorkflow?.diagram?.nodes ?? []),
    zoom: activeWorkflow?.diagram?.zoom ?? 1
  });

  // ‚úÖ Sync when workflow changes
  useEffect(() => {
    setNodes(activeWorkflow?.diagram?.nodes ?? []);
    setEdges(activeWorkflow?.diagram?.edges ?? []);
    setZoom(activeWorkflow?.diagram?.zoom ?? 1);
    setViewMode("diagram");
    setSelectedNodeId(null);
    setSavedToast(false);

    initialRef.current = {
      nodes: JSON.stringify(activeWorkflow?.diagram?.nodes ?? []),
      zoom: activeWorkflow?.diagram?.zoom ?? 1
    };
  }, [activeWorkflow?.id]); // eslint-disable-line react-hooks/exhaustive-deps

  const dirty = useMemo(() => {
    return (
      JSON.stringify(nodes) !== initialRef.current.nodes ||
      zoom !== initialRef.current.zoom
    );
  }, [nodes, zoom]);

  function addNode() {
    const id = `step-${Math.random().toString(16).slice(2, 7)}`;
    const baseX = 120 + Math.floor(Math.random() * 12) * grid * 6;
    const baseY = 120 + Math.floor(Math.random() * 8) * grid * 5;

    setNodes((prev) => [
      ...prev,
      {
        id,
        x: snapToGrid(baseX, grid),
        y: snapToGrid(baseY, grid),
        w: 260,
        h: 80,
        title: "New step",
        detail: "Describe what happens here"
      }
    ]);
    setSelectedNodeId(id);
  }

  function onPointerDown(e, nodeId) {
    e.preventDefault();
    const n = nodes.find((x) => x.id === nodeId);
    if (!n) return;

    setSelectedNodeId(nodeId);
    setDrag({
      id: nodeId,
      startX: e.clientX,
      startY: e.clientY,
      originX: n.x,
      originY: n.y
    });
  }

  function onPointerMove(e) {
    if (!drag) return;

    // ‚úÖ scale-aware dragging
    const dx = (e.clientX - drag.startX) / zoom;
    const dy = (e.clientY - drag.startY) / zoom;

    setNodes((prev) =>
      prev.map((n) => {
        if (n.id !== drag.id) return n;
        return {
          ...n,
          x: snapToGrid(drag.originX + dx, grid),
          y: snapToGrid(drag.originY + dy, grid)
        };
      })
    );
  }

  function onPointerUp() {
    setDrag(null);
  }

  function clampZoom(z) {
    return Math.max(0.5, Math.min(2.5, z));
  }

  function zoomIn() {
    setZoom((z) => clampZoom(Number((z + 0.1).toFixed(2))));
  }

  function zoomOut() {
    setZoom((z) => clampZoom(Number((z - 0.1).toFixed(2))));
  }

  function onWheel(e) {
    // ‚úÖ Ctrl+wheel zoom
    if (!e.ctrlKey) return;
    e.preventDefault();

    const delta = e.deltaY;
    const next = delta > 0 ? zoom - 0.05 : zoom + 0.05;
    setZoom(clampZoom(Number(next.toFixed(2))));
  }

  async function saveLayout() {
    if (!dirty || saving) return;
    setSaving(true);
    setSavedToast(false);

    try {
      const res = await fetch("/api/workflows/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          workflowId: activeWorkflow.id,
          nodes,
          zoom
        })
      });

      const json = await res.json();
      if (!json.ok) throw new Error(json.error || "Save failed");

      initialRef.current = {
        nodes: JSON.stringify(nodes),
        zoom
      };

      setSavedToast(true);
      setTimeout(() => setSavedToast(false), 1400);
    } catch (err) {
      console.error(err);
      alert(`Save failed: ${err?.message || "unknown error"}`);
    } finally {
      setSaving(false);
    }
  }

  const GridBackground = () => (
    <div
      className="absolute inset-0 pointer-events-none"
      style={{
        backgroundImage: `
          linear-gradient(to right, rgba(24,24,27,0.06) 1px, transparent 1px),
          linear-gradient(to bottom, rgba(24,24,27,0.06) 1px, transparent 1px)
        `,
        backgroundSize: `${grid}px ${grid}px`
      }}
    />
  );

  const Diagram = () => {
    // ‚úÖ Full workspace height (near-top of workspace down to AI dock)
    const diagramHeight = "calc(100vh - 160px)";

    // Big virtual canvas so there‚Äôs room to spread out
    const canvasW = 2200;
    const canvasH = 1400;

    return (
      <div
        className="relative rounded-2xl border border-zinc-200/80 bg-[#fbfbfa] overflow-hidden"
        style={{ height: diagramHeight }}
        onPointerMove={onPointerMove}
        onPointerUp={onPointerUp}
        onPointerLeave={onPointerUp}
        onWheel={onWheel}
      >
        {/* Scrollable space */}
        <div className="absolute inset-0 overflow-auto">
          {/* Scaled canvas */}
          <div
            className="relative"
            style={{
              width: canvasW * zoom,
              height: canvasH * zoom
            }}
          >
            <div
              className="absolute left-0 top-0"
              style={{
                width: canvasW,
                height: canvasH,
                transform: `scale(${zoom})`,
                transformOrigin: "0 0"
              }}
            >
              <GridBackground />

              {/* Edges SVG */}
              <svg className="absolute inset-0 w-full h-full">
                <defs>
                  <marker
                    id="arrow"
                    viewBox="0 0 10 10"
                    refX="9"
                    refY="5"
                    markerWidth="6"
                    markerHeight="6"
                    orient="auto"
                  >
                    <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(24,24,27,0.55)" />
                  </marker>
                </defs>

                {edges.map((e) => {
                  const fromNode = nodes.find((n) => n.id === e.from);
                  const toNode = nodes.find((n) => n.id === e.to);
                  if (!fromNode || !toNode) return null;

                  const fromSide = choosePortSide(fromNode, toNode);
                  const toSide = oppositeSide(fromSide);

                  const p0 = portPoint(fromNode, fromSide);
                  const p3 = portPoint(toNode, toSide);

                  const { d, c1, c2 } = edgeBezier(p0, p3, fromSide, toSide);
                  const mid = cubicAt(p0, c1, c2, p3, 0.5);

                  return (
                    <g key={e.id}>
                      <path
                        d={d}
                        fill="none"
                        stroke="rgba(24,24,27,0.45)"
                        strokeWidth="2"
                        markerEnd="url(#arrow)"
                      />

                      {/* Port anchors */}
                      <circle
                        cx={p0.x}
                        cy={p0.y}
                        r="5.5"
                        fill="white"
                        stroke="rgba(24,24,27,0.45)"
                        strokeWidth="2"
                      />
                      <circle
                        cx={p3.x}
                        cy={p3.y}
                        r="5.5"
                        fill="white"
                       z
                        stroke="rgba(24,24,27,0.45)"
                        strokeWidth="2"
                      />

                      {/* Upright label pill */}
                      <g transform={`translate(${mid.x}, ${mid.y})`}>
                        <rect
                          x="-62"
                          y="-12"
                          width="124"
                          height="24"
                          rx="12"
                          fill="rgba(251,251,250,0.95)"
                          stroke="rgba(24,24,27,0.14)"
                        />
                        <text
                          x="0"
                          y="4"
                          textAnchor="middle"
                          fontSize="11"
                          fill="rgba(24,24,27,0.72)"
                          style={{ userSelect: "none" }}
                        >
                          {e.label}
                        </text>
                      </g>
                    </g>
                  );
                })}
              </svg>

              {/* Nodes */}
              {nodes.map((n) => {
                const isSelected = selectedNodeId === n.id;
                const isStart = n.type === "start";
                const isEnd = n.type === "end";

                return (
                  <div
                    key={n.id}
                    onPointerDown={(e) => onPointerDown(e, n.id)}
                    onClick={() => setSelectedNodeId(n.id)}
                    className={cx(
                      "absolute select-none cursor-grab active:cursor-grabbing",
                      "rounded-2xl border bg-white",
                      "shadow-[0_1px_0_rgba(0,0,0,0.05),0_10px_24px_rgba(0,0,0,0.06)]",
                      isSelected
                        ? "border-zinc-900 ring-2 ring-zinc-900/10"
                        : "border-zinc-200/80",
                      isStart && "ring-1 ring-emerald-500/20",
                      isEnd && "ring-1 ring-zinc-900/20"
                    )}
                    style={{
                      left: n.x,
                      top: n.y,
                      width: n.w,
                      height: n.h
                    }}
                  >
                    {/* Start/End markers */}
                    {(isStart || isEnd) && (
                      <div className="absolute right-2 top-2">
                        <span
                          className={cx(
                            "text-[10px] px-2 py-0.5 rounded-full border tracking-tight",
                            isStart
                              ? "bg-emerald-50 border-emerald-200/70 text-emerald-900"
                              : "bg-[#fbfbfa] border-zinc-200/80 text-zinc-800"
                          )}
                        >
                          {isStart ? "Start" : "End"}
                        </span>
                      </div>
                    )}

                    <div className="px-4 py-3">
                      <div className="text-[13px] font-semibold tracking-tight text-zinc-900">
                        {n.title}
                      </div>
                      <div className="mt-1 text-[11px] text-zinc-600 tracking-tight line-clamp-2">
                        {n.detail}
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>

        {/* Zoom overlay controls */}
        <div className="absolute right-4 top-4 flex items-center gap-2">
          <div className="text-[11px] px-2 py-1 rounded-full bg-white border border-zinc-200/80 text-zinc-700">
            {Math.round(zoom * 100)}%
          </div>

          <button
            onClick={zoomOut}
            className="h-9 w-9 rounded-xl bg-white border border-zinc-200/80 grid place-items-center hover:bg-zinc-100 transition-colors"
            title="Zoom out"
          >
            <ZoomOut size={16} strokeWidth={1.8} className="text-zinc-700" />
          </button>

          <button
            onClick={zoomIn}
            className="h-9 w-9 rounded-xl bg-white border border-zinc-200/80 grid place-items-center hover:bg-zinc-100 transition-colors"
            title="Zoom in"
          >
            <ZoomIn size={16} strokeWidth={1.8} className="text-zinc-700" />
          </button>
        </div>
      </div>
    );
  };

  const TextView = () => (
    <div className="rounded-2xl border border-zinc-200/80 bg-white shadow-[0_1px_0_rgba(0,0,0,0.05),0_14px_40px_rgba(0,0,0,0.06)] p-6">
      <div className="text-[13px] font-semibold tracking-tight text-zinc-900">
        {activeWorkflow?.title}
      </div>
      <div className="mt-1 text-[12px] text-zinc-600 tracking-tight">
        {activeWorkflow?.summary}
      </div>

      <div className="mt-5">
        <div className="text-[11px] font-medium text-zinc-500 tracking-tight">
          Steps (text view)
        </div>

        <div className="mt-3 space-y-2">
          {(activeWorkflow?.textSteps ?? []).map((s, idx) => (
            <div
              key={idx}
              className="flex gap-3 text-[13px] tracking-tight text-zinc-800"
            >
              <div className="text-zinc-400 w-5 text-right">{idx + 1}</div>
              <div>{s}</div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  return (
    // ‚úÖ Remove max-w; make workflow canvas use full workspace width
    <div className="px-6 pt-6 pb-8 w-full">
      {/* Header row */}
      <div className="flex items-start justify-between gap-6">
        <div className="min-w-0">
          <div className="text-[28px] leading-[1.12] font-semibold tracking-tight text-zinc-900">
            Workflows
          </div>
          <div className="mt-2 text-[13px] text-zinc-600 tracking-tight">
            Standard SOP flows: **start** ‚Üí scenarios ‚Üí **end**.
          </div>
        </div>

        <div className="flex items-center gap-2">
          <button
            onClick={addNode}
            className="text-[12px] px-3 py-2 rounded-xl bg-white border border-zinc-200/80 hover:bg-zinc-100 transition-colors inline-flex items-center gap-2"
          >
            <Plus size={16} strokeWidth={1.8} className="text-zinc-700" />
            Add step
          </button>

          <button
            onClick={saveLayout}
            disabled={!dirty || saving}
            className={cx(
              "text-[12px] px-3 py-2 rounded-xl inline-flex items-center gap-2 transition-colors",
              dirty && !saving
                ? "bg-zinc-900 text-white hover:bg-zinc-800"
                : "bg-zinc-200 text-zinc-500 cursor-not-allowed"
            )}
            title={dirty ? "Save layout + zoom" : "No changes to save"}
          >
            <Save size={16} strokeWidth={1.8} />
            {saving ? "Saving..." : "Save"}
          </button>
        </div>
      </div>

      {/* Controls row */}
      <div className="mt-5 flex items-center justify-between gap-3">
        <div className="flex items-center gap-2 min-w-0">
          <div className="text-[11px] text-zinc-500 tracking-tight">Workflow</div>

          {/* Dropdown still available, but sidebar drives selection too */}
          <select
            value={activeWorkflow?.id || ""}
            onChange={(e) => onSelectWorkflowId?.(e.target.value)}
            className="text-[13px] px-3 py-2 rounded-xl bg-white border border-zinc-200/80 outline-none min-w-[320px]"
          >
            {workflows.map((w) => (
              <option key={w.id} value={w.id}>
                {w.title}
              </option>
            ))}
          </select>

          <span className="text-[11px] px-2 py-1 rounded-full bg-[#fbfbfa] border border-zinc-200/80 text-zinc-700">
            {activeWorkflow?.owner === "team" ? "User-made" : "My workflow"}
          </span>

          {savedToast ? (
            <span className="text-[11px] px-2 py-1 rounded-full bg-emerald-50 border border-emerald-200/70 text-emerald-900">
              Saved ‚úì
            </span>
          ) : null}
        </div>

        <div className="flex items-center gap-2">
          <button
            onClick={() => setViewMode("diagram")}
            className={cx(
              "text-[12px] px-3 py-2 rounded-xl border transition-colors inline-flex items-center gap-2",
              viewMode === "diagram"
                ? "bg-zinc-900 text-white border-zinc-900"
                : "bg-white text-zinc-700 border-zinc-200/80 hover:bg-zinc-100"
            )}
          >
            <WorkflowIcon size={16} strokeWidth={1.8} />
            Diagram
          </button>

          <button
            onClick={() => setViewMode("text")}
            className={cx(
              "text-[12px] px-3 py-2 rounded-xl border transition-colors inline-flex items-center gap-2",
              viewMode === "text"
                ? "bg-zinc-900 text-white border-zinc-900"
                : "bg-white text-zinc-700 border-zinc-200/80 hover:bg-zinc-100"
            )}
          >
            <List size={16} strokeWidth={1.8} />
            Text
          </button>
        </div>
      </div>

      {/* Body */}
      <div className="mt-4">
        {viewMode === "diagram" ? (
          <>
            <div className="mb-3 flex items-center justify-between">
              <div className="text-[12px] text-zinc-500 tracking-tight">
                Drag steps ‚Ä¢ snaps to grid ‚Ä¢ ports ‚Ä¢ readable labels ‚Ä¢ Ctrl+wheel zoom
              </div>
              <div className="text-[11px] text-zinc-500 tracking-tight">
                {dirty ? "Unsaved changes" : "All changes saved"}
              </div>
            </div>
            <Diagram />
          </>
        ) : (
          <TextView />
        )}
      </div>
    </div>
  );
}


==========================================================================================
FILE: components/Workspace copy.js
==========================================================================================
// components/Workspace.js
"use client";

import { useEffect, useLayoutEffect, useMemo, useRef, useState } from "react";
import { FileText, GitBranch, Search as SearchIcon } from "lucide-react";

import RequirementsViewport from "./RequirementsViewport";
import ProcessDiagramViewport from "./ProcessDiagramViewport";
import RootCauseViewport from "./RootCauseViewport";
import AiDock from "./AiDock";

const cx = (...c) => c.filter(Boolean).join(" ");

export default function Workspace({ tabData, onUpdateRequirements, requirementsUnlocked, onListViewUnlock }) {
  const Viewport = useMemo(() => {
    if (tabData.tabId === "requirements") return RequirementsViewport;
    if (tabData.tabId === "processDiagram") return ProcessDiagramViewport;
    return RootCauseViewport;
  }, [tabData.tabId]);

  const Icon = useMemo(() => {
    if (tabData.tabId === "requirements") return FileText;
    if (tabData.tabId === "processDiagram") return GitBranch;
    return SearchIcon;
  }, [tabData.tabId]);

  const dockRef = useRef(null);
  const [dockHeight, setDockHeight] = useState(0);

  const [enter, setEnter] = useState(false);
  useEffect(() => {
    setEnter(false);
    const id = requestAnimationFrame(() => setEnter(true));
    return () => cancelAnimationFrame(id);
  }, [tabData.tabId]);

  useLayoutEffect(() => {
    if (!dockRef.current) return;
    const el = dockRef.current;

    const ro = new ResizeObserver((entries) => {
      const h = Math.ceil(entries[0].contentRect.height);
      setDockHeight(h);
    });

    ro.observe(el);
    return () => ro.disconnect();
  }, []);

  return (
    <div className="flex-1 overflow-hidden bg-[#fbfbfa]">
      <div className="h-full flex flex-col">
        {/* header */}
        <div className="h-12 px-6 flex items-center justify-between bg-[#fbfbfa] border-b border-zinc-200/70">
          <div className="flex items-center gap-2 min-w-0">
            <Icon size={18} strokeWidth={1.6} className="text-zinc-700" />
            <div className="text-[13px] font-semibold tracking-tight text-zinc-900 truncate">
              {tabData.title}
            </div>
            <div className="text-[11px] text-zinc-500 whitespace-nowrap">
              ‚Ä¢ {tabData.meta.visibility}
            </div>
          </div>
          <div className="text-[11px] text-zinc-500 whitespace-nowrap">
            {tabData.meta.edited}
          </div>
        </div>

        <div className="relative flex-1 overflow-hidden">
          {/* scroll */}
          <div
            className="h-full overflow-y-auto"
            style={{ paddingBottom: dockHeight ? dockHeight + 28 : 320 }}
          >
            <div
              className={cx(
                "transition-opacity duration-200",
                enter ? "opacity-100" : "opacity-0"
              )}
            >
              <Viewport
                data={tabData}
                onUpdateRequirements={onUpdateRequirements}
                requirementsUnlocked={requirementsUnlocked}
                onListViewUnlock={onListViewUnlock}
              />
            </div>

            <div className="h-10" />
          </div>

          {/* fades */}
          <div
            aria-hidden="true"
            className="pointer-events-none absolute top-0 left-0 right-0 h-10 bg-gradient-to-b from-[#fbfbfa] to-transparent"
          />
          <div
            aria-hidden="true"
            className="pointer-events-none absolute bottom-0 left-0 right-0 h-28 bg-gradient-to-t from-[#fbfbfa] to-transparent"
          />

          {/* pinned centered dock */}
          <div className="absolute left-0 right-0 bottom-0">
            <div className="px-8 pb-6">
              <div ref={dockRef}>
                <AiDock tabData={tabData} />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}


==========================================================================================
FILE: components/Workspace.js
==========================================================================================
// components/Sidebar.js
"use client";

import { useMemo, useState } from "react";
import {
  Home,
  CalendarDays,
  Sparkles,
  Inbox,
  Settings,
  Trash2,
  Search,
  ChevronDown,
  GitBranch,
  Plus
} from "lucide-react";

const cx = (...c) => c.filter(Boolean).join(" ");

function NavItem({ icon: Icon, label, active, onClick, right }) {
  return (
    <button
      type="button"
      onClick={onClick}
      className={cx(
        "w-full px-2 py-1.5 rounded-md cursor-default flex items-center gap-2",
        "text-[13px] tracking-tight text-left",
        "hover:bg-zinc-200/40 transition-colors",
        active ? "bg-zinc-200/50 text-zinc-900" : "text-zinc-700"
      )}
    >
      <Icon size={16} strokeWidth={1.7} className="text-zinc-700" />
      <span className="truncate font-medium flex-1">{label}</span>
      {right}
    </button>
  );
}

function ModernCheckbox({ defaultChecked }) {
  const [checked, setChecked] = useState(!!defaultChecked);

  const tick =
    "data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20viewBox%3D%270%200%2024%2024%27%20fill%3D%27none%27%20stroke%3D%27white%27%20stroke-width%3D%272.8%27%20stroke-linecap%3D%27round%27%20stroke-linejoin%3D%27round%27%3E%3Cpolyline%20points%3D%2720%206%209%2017%204%2012%27/%3E%3C/svg%3E";

  return (
    <input
      type="checkbox"
      checked={checked}
      onChange={(e) => setChecked(e.target.checked)}
      className={cx(
        "h-4 w-4 rounded-[6px] appearance-none",
        "bg-white border border-zinc-300/80",
        "focus:outline-none focus:ring-2 focus:ring-zinc-300",
        "transition bg-no-repeat bg-center"
      )}
      style={{
        backgroundSize: "14px 14px",
        backgroundImage: checked ? `url("${tick}")` : "none",
        backgroundColor: checked ? "#18181b" : "#ffffff"
      }}
      aria-checked={checked}
    />
  );
}

function SubItem({ label, onClick, active, icon: Icon }) {
  return (
    <button
      type="button"
      onClick={onClick}
      className={cx(
        "w-full px-2 py-1.5 rounded-md text-left",
        "text-[12px] tracking-tight",
        "hover:bg-zinc-200/40 transition-colors",
        "flex items-center gap-2",
        active ? "text-zinc-900 bg-zinc-200/40" : "text-zinc-700"
      )}
    >
      {Icon ? <Icon size={14} strokeWidth={1.8} className="text-zinc-600" /> : null}
      <span className="truncate">{label}</span>
    </button>
  );
}

export default function Sidebar({
  tasksTitle,
  tasks = [],
  activeTab,
  onChangeTab,
  workflows = [],
  selectedWorkflowId,
  onSelectWorkflowId,
  onCreateWorkflow
}) {
  const [workflowsOpen, setWorkflowsOpen] = useState(true);

  const rightChevron = useMemo(
    () => (
      <ChevronDown
        size={16}
        strokeWidth={1.8}
        className={cx(
          "text-zinc-500 transition-transform",
          workflowsOpen ? "rotate-0" : "-rotate-90"
        )}
      />
    ),
    [workflowsOpen]
  );

  const firstDesign = workflows.find((w) => w.category === "design")?.id;
  const firstValidation = workflows.find((w) => w.category === "validation")?.id;
  const firstMine = workflows.find((w) => w.owner === "me")?.id;

  return (
    <aside className="w-[280px] h-full bg-[#f5f5f3] border-r border-zinc-200/70">
      <div className="h-full flex flex-col px-3 py-3">
        {/* header */}
        <div className="flex items-center gap-3 px-2 py-2 rounded-md hover:bg-zinc-200/40 transition-colors">
          <div className="h-8 w-8 rounded-xl bg-white border border-zinc-200/80 flex items-center justify-center text-xs font-semibold text-zinc-800">
            IA
          </div>
          <div className="min-w-0 leading-tight">
            <div className="text-[13px] font-semibold tracking-tight text-zinc-900 truncate">
              Engineering Space
            </div>
            <div className="text-[11px] text-zinc-500 truncate">Workspace ‚Ä¢ mock</div>
          </div>
        </div>

        {/* search */}
        <div className="mt-2 px-2">
          <div className="rounded-md bg-white border border-zinc-200/80 px-2.5 py-2 flex items-center gap-2">
            <Search size={16} strokeWidth={1.7} className="text-zinc-600" />
            <input
              className="w-full text-[13px] tracking-tight outline-none placeholder:text-zinc-400 bg-transparent"
              placeholder="Search"
              disabled
            />
          </div>
        </div>

        {/* nav */}
        <div className="mt-3 px-2 space-y-0.5">
          <NavItem icon={Home} label="Home" />
          <NavItem icon={CalendarDays} label="Meetings" />
          <NavItem icon={Sparkles} label="Notion AI" />
          <NavItem icon={Inbox} label="Inbox" />

          {/* Workflows */}
          <NavItem
            icon={GitBranch}
            label="Workflows"
            active={activeTab === "workflows"}
            right={rightChevron}
            onClick={() => {
              setWorkflowsOpen((v) => !v);
              onChangeTab?.("workflows");
            }}
          />

          {workflowsOpen ? (
            <div className="pl-6 mt-0.5 space-y-0.5">
              <SubItem
                label="Design Workflows"
                active={selectedWorkflowId === firstDesign}
                onClick={() => {
                  onChangeTab?.("workflows");
                  if (firstDesign) onSelectWorkflowId?.(firstDesign);
                }}
              />
              <SubItem
                label="Validation Workflows"
                active={selectedWorkflowId === firstValidation}
                onClick={() => {
                  onChangeTab?.("workflows");
                  if (firstValidation) onSelectWorkflowId?.(firstValidation);
                }}
              />
              <SubItem
                label="My Workflows"
                active={selectedWorkflowId === firstMine}
                onClick={() => {
                  onChangeTab?.("workflows");
                  if (firstMine) onSelectWorkflowId?.(firstMine);
                }}
              />

              {/* NEW: Add workflow */}
              <SubItem
                label="Add new workflow"
                icon={Plus}
                onClick={() => {
                  onChangeTab?.("workflows");
                  onCreateWorkflow?.();
                }}
              />
            </div>
          ) : null}
        </div>

        {/* tasks */}
        <div className="mt-5 px-2">
          <div className="text-[11px] font-medium text-zinc-500 tracking-tight">
            {tasksTitle || "Tasks"}
          </div>

          <div className="mt-2 space-y-1">
            {tasks.map((t) => (
              <div
                key={t.id}
                className={cx(
                  "px-2 py-1.5 rounded-md",
                  "hover:bg-zinc-200/40 transition-colors",
                  "flex items-center gap-2"
                )}
              >
                <ModernCheckbox defaultChecked={t.done} />
                <div
                  className={cx(
                    "text-[13px] tracking-tight",
                    t.done ? "text-zinc-400 line-through" : "text-zinc-800"
                  )}
                >
                  {t.label}
                </div>
              </div>
            ))}

            {!tasks.length ? (
              <div className="text-[12px] text-zinc-500 px-2 py-2">
                No tasks in this tab.
              </div>
            ) : null}
          </div>
        </div>

        {/* footer */}
        <div className="mt-auto px-2 pt-4 space-y-0.5">
          <NavItem icon={Settings} label="Settings" />
          <NavItem icon={Trash2} label="Trash" />
        </div>
      </div>
    </aside>
  );
}
